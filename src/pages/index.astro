---
import Layout from "@layouts/Layout.astro";
import { authStore } from "@lib/stores/auth/authStore";
import Dashboard from "@components/dashboard/Dashboard";
import Header from "@components/nav/Header";

const accessToken = Astro.cookies.get("sb-access-token")?.value;
const refreshToken = Astro.cookies.get("sb-refresh-token")?.value;

const { session } = authStore.get();
---

<Layout>
  <Header client:load />
  <Dashboard accessToken={accessToken} refreshToken={refreshToken} initialSession={session} client:load />
</Layout>

<script>
  const storedTheme = localStorage.getItem("theme");
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  const theme = storedTheme ?? (prefersDark ? "dark" : "light");
  document.documentElement.setAttribute("data-user-theme", theme);
</script>
